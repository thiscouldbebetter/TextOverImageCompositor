<html>

<head>
	<style>
		@font-face {
			font-family: "SquarePlusMinusPipe";
			src:
				local("SquarePlusMinusPipe.ttf"),
		}

		.inputText
		{
			width: 64px;
		}

		textarea
		{
			border: 0px;
			background-color: Transparent;
			resize: none;
			font-family: sans-serif;
			font-size: 32px;
			font-weight: bold;
			color: White;
			-webkit-text-fill-color: Black;
			-webkit-text-stroke: 1px;
		}
	</style>

</head>

</head>

<body>

	<div id="divUi">

		<h3>Text-Over-Image Compositor</h3>

		<p>
			Upload an image, select a font, and then type text over the image.
			The resulting composition can then be saved via screenshot.
		</p>

		<div>
			<label>Image File:</label>
			<input
				id="inputImageFile"
				type="file"
				onchange="UiEventHandler.inputImageFile_Changed(this)"
			></input>
		</div>

		<div>
			<label>Image:</label>

			<div>
				<label>Size in Pixels:</label>
				<label>X:</label>
				<input
					id="inputImageSizeInPixelsX"
					class="inputText"
					type="number"
					min="0" step="1"
				></input>
				<label>Y:</label>
				<input
					id="inputImageSizeInPixelsY"
					class="inputText"
					type="number"
					min="0" step="1"
				></input>
			</div>

			<div>
				<label>Offset In Pixels:</label>
				<label>X:</label>
				<input
					id="inputImageOffsetInPixelsX"
					class="inputText"
					type="number"
					step="1"
					value="0"
				></input>
				<label>Y:</label>
				<input
					id="inputImageOffsetInPixelsY"
					class="inputText"
					type="number"
					step="1"
					value="0"
				></input>
			</div>

			<button onclick="UiEventHandler.buttonImageResize_Clicked()">Resize</button>
		</div>

		<div>
			<label>Font:</label>

			<div>
				<label>Name:</label>
				<select
					id="selectFontFamily"
					onchange="UiEventHandler.selectFontFamily_Changed(this)"
				>
					<option>sans-serif</option>
					<option>serif</option>
					<option>SquarePlusMinusPipe</option>
				</select>

				<label>Height in Pixels:</label>
				<input
					id="inputFontHeight"
					class="inputText"
					type="number"
					min="1" max="200" step="1"
					value="32"
					onchange="UiEventHandler.inputFontHeight_Changed(this)"
				></input>

				<label>Weight:</label>
				<select
					id="selectFontWeight"
					onchange="UiEventHandler.selectFontWeight_Changed(this)"
				>
					<option>bold</option>
					<option>normal</option>
					<option>bolder</option>
				</select>

				<div>
					<label>Colors:</label>

					<label>Fill:</label>
					<input
						id="inputFontColorFill"
						class="inputText"
						value="Black"
						onchange="UiEventHandler.inputFontColorFill_Changed(this)"
					></input>

					<label>Outline:</label>
					<input
						id="inputFontColorOutline"
						class="inputText"
						value="White"
						onchange="UiEventHandler.inputFontColorOutline_Changed(this)"
					></input>

					<input
						id="inputFontOutlineThickness"
						class="inputText"
						type="number"
						min="0" max="100"
						value=".5"
						onchange="UiEventHandler.inputFontOutlineThickness_Changed(this)"
					></input>
					<label>px</label>
				</div>

			</div>

		</div>

		<div>
			<label>Image with Text Overlay:</label>
			<div id="divImageAndText">
				<div id="divImage" style="position: absolute">
					[No image loaded yet.]
				</div>
				<div
					id="divText"
					style="position: relative"
				>
					<textarea
						id="textareaOverlay"
						wrap="off"
					></textarea>
				</div>
			</div>
		</div>

		<div>
			<button
				onclick="UiEventHandler.buttonMergeImageAndText_Clicked()"
			>
				Merge Image and Text
			</button>
		</div>

		<div>
			<label>Image and Text Merged:</label>
		</div>

		<div id="divImageAndTextMerged">
			[No image merged yet.]
		</div>

	</div>

<script type="text/javascript">

class UiEventHandler
{
	static buttonImageResize_Clicked()
	{
		var d = document;

		var inputImageSizeInPixelsX =
			d.getElementById("inputImageSizeInPixelsX");
		var inputImageSizeInPixelsY =
			d.getElementById("inputImageSizeInPixelsY");

		var inputImageOffsetInPixelsX =
			d.getElementById("inputImageOffsetInPixelsX");
		var inputImageOffsetInPixelsY =
			d.getElementById("inputImageOffsetInPixelsY");

		var imageSizeInPixelsX = parseInt(inputImageSizeInPixelsX.value);
		var imageSizeInPixelsY = parseInt(inputImageSizeInPixelsY.value);

		var imageOffsetInPixelsX = parseInt(inputImageOffsetInPixelsX.value);
		var imageOffsetInPixelsY = parseInt(inputImageOffsetInPixelsY.value);

		var imgImage = d.getElementById("imgImage");
		imgImage.width = imageSizeInPixelsX;
		imgImage.height = imageSizeInPixelsY;

		imgImage.style.position = "relative";
		imgImage.style.left = imageOffsetInPixelsX;
		imgImage.style.top = imageOffsetInPixelsY;

		var textareaOverlay =
			d.getElementById("textareaOverlay");
		textareaOverlay.style.width = imageSizeInPixelsX;
		textareaOverlay.style.height = imageSizeInPixelsY;
	}

	static buttonMergeImageAndText_Clicked()
	{
		var d = document;

		var imgImage = d.getElementById("imgImage");
		if (imgImage != null)
		{
			var textareaOverlay =
				d.getElementById("textareaOverlay");
			var textToMerge = textareaOverlay.value;
			var newline = "\n";
			var textToMergeLines = textToMerge.split(newline);

			var selectFontFamily =
				d.getElementById("selectFontFamily");
			var inputFontHeight =
				d.getElementById("inputFontHeight");
			var inputFontColorFill =
				d.getElementById("inputFontColorFill");
			var inputFontColorOutline =
				d.getElementById("inputFontColorOutline");
			var inputFontOutlineThickness =
				d.getElementById("inputFontOutlineThickness");
			var selectFontWeight =
				d.getElementById("selectFontWeight");

			var fontFamilyName = selectFontFamily.value;
			var fontHeightInPixels = parseFloat(inputFontHeight.value);
			var colorFill = inputFontColorFill.value;
			var colorOutline = inputFontColorOutline.value;
			var fontOutlineThicknessInPixels =
				parseFloat(inputFontOutlineThickness.value);
			var fontWeight = selectFontWeight.value;

			var canvasMerged = d.createElement("canvas");
			canvasMerged.width = imgImage.width;
			canvasMerged.height = imgImage.height;

			var graphics = canvasMerged.getContext("2d");

			graphics.drawImage(imgImage, 0, 0);

			graphics.fillStyle = colorFill;
			graphics.strokeStyle = colorOutline;
			graphics.lineWidth = fontOutlineThicknessInPixels;
			var font =
				fontWeight + " " + fontHeightInPixels + "px " + fontFamilyName;
			graphics.font = font;

			for (var y = 0; y < textToMergeLines.length; y++)
			{
				var line = textToMergeLines[y];

				var drawPosY = (y + 1) * fontHeightInPixels;

				graphics.fillText(line, 0, drawPosY);
				graphics.strokeText(line, 0, drawPosY);
			}

			var divImageAndTextMerged =
				d.getElementById("divImageAndTextMerged");
			divImageAndTextMerged.innerHTML = "";
			divImageAndTextMerged.appendChild(canvasMerged);
		}
	}

	static inputFontColorFill_Changed(inputFontColorFill)
	{
		var d = document;
		var textareaOverlay =
			d.getElementById("textareaOverlay");
		var fontColor = inputFontColorFill.value;
		textareaOverlay.style.webkitTextFillColor = fontColor;
	}

	static inputFontColorOutline_Changed(inputFontColorOutline)
	{
		var d = document;
		var textareaOverlay =
			d.getElementById("textareaOverlay");
		var fontColor = inputFontColorOutline.value;
		textareaOverlay.style.color = fontColor;
	}

	static inputFontHeight_Changed(inputFontHeight)
	{
		var d = document;
		var textareaOverlay =
			d.getElementById("textareaOverlay");
		var fontHeightInPixels = inputFontHeight.value;
		textareaOverlay.style.fontSize = fontHeightInPixels + "px";
	}

	static inputFontOutlineThickness_Changed(inputFontOutlineThickness)
	{
		var d = document;
		var textareaOverlay =
			d.getElementById("textareaOverlay");
		var fontOutlineThicknessInPixels = inputFontOutlineThickness.value;
		textareaOverlay.style.webkitTextStroke = fontOutlineThicknessInPixels + "px";
	}

	static inputImageFile_Changed(inputImageFile)
	{
		var file = inputImageFile.files[0];
		if (file != null)
		{
			var fileReader = new FileReader();
			fileReader.onload = (event) =>
			{
				var imageAsDataUrl = event.target.result;
				var d = document;
				var imgElement = d.createElement("img");
				imgElement.id = "imgImage";
				imgElement.onload = (event2) =>
				{
					var divImage =
						d.getElementById("divImage");
					divImage.innerHTML = "";
					divImage.appendChild(imgElement);

					var textareaOverlay =
						d.getElementById("textareaOverlay");
					textareaOverlay.style.width = imgElement.width;
					textareaOverlay.style.height = imgElement.height;

					var inputImageSizeInPixelsX =
						d.getElementById("inputImageSizeInPixelsX");
					var inputImageSizeInPixelsY =
						d.getElementById("inputImageSizeInPixelsY");

					inputImageSizeInPixelsX.value = imgElement.width;
					inputImageSizeInPixelsY.value = imgElement.height;
				}
				imgElement.src = imageAsDataUrl;
			};
			fileReader.readAsDataURL(file);
		}
	}

	static selectFontFamily_Changed(selectFontFamily)
	{
		var d = document;
		var textareaOverlay =
			d.getElementById("textareaOverlay");
		var fontFamilySelectedName = selectFontFamily.value;
		textareaOverlay.style.fontFamily = fontFamilySelectedName;
	}

	static selectFontWeight_Changed(selectFontWeight)
	{
		var d = document;
		var textareaOverlay =
			d.getElementById("textareaOverlay");
		var fontWeightSelectedName = selectFontWeight.value;
		textareaOverlay.style.fontWeight = fontWeightSelectedName;
	}
}

</script>

</body>

</html>